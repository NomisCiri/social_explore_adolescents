---
title: "Write Reproducible Results Section"
author: "Andrea"
date: "2024-07-31"
output: html_document
---

```{r echo=FALSE, warning=FALSE, message=FALSE, echo=FALSE}

## load packages @andrea implement pck_mgmt script
pacman::p_load(tidyverse,
               rjson,
               data.table,
               gghalves,
               here,
               lme4,
               lmerTest,
               broom.mixed,
               infer,
               ggthemes,
               sjPlot)

'%!in%' <- function(x,y)!('%in%'(x,y))

options(scipen = 999,digits = 4)

## function to extract coefficients
source("extract_coefficients.R")

## function to calculate Bayes Factor
source("calculate_BF.R")

## set custom theme
source("https://raw.githubusercontent.com/AndGrad/custom_themes_ggplot/main/theme_plot.R")

```

```{r load data, echo=FALSE, warning=FALSE, message=FALSE }
## load data
all_data <- read_csv(file = paste0(here(), "/data/social/data_social_all_participants_08-2024.csv"))

all_data <- all_data %>% 
  mutate(demo_quality_f = as.factor(demo_quality),
          age_f = factor(group, levels = c("adults", "adolescents")),
          treatment= factor(
            ifelse(demo_quality_f == "best" & age_f == "adults", "adu_best",
            ifelse(demo_quality_f == "medium" & age_f == "adults", "adu_medium",
            ifelse(demo_quality_f == "worst" & age_f == "adults", "adu_worst",
            ifelse(demo_quality_f == "best" & age_f == "adolescents", "ado_best",
            ifelse(demo_quality_f == "medium" & age_f == "adolescents", "ado_medium",
            ifelse(demo_quality_f == "worst" & age_f == "adolescents", "ado_worst", NA)))))))) ## mutate IVs into factors

```

## differences in points scored by group

```{r points by age group regression}

## just raw difference in points across conditions
t_test_points <- all_data %>% 
  ungroup() %>% 
  group_by(uniqueID) %>% 
  mutate(mean_points_player = mean(tot_points, na.rm = TRUE)) %>% 
  select(mean_points_player, age_f, uniqueID) %>% 
  distinct() %>% 
  ungroup() %>% 
  stats::t.test(mean_points_player ~ age_f, data = ., alternative = "two.sided", paired = FALSE)

## load model fit object 
base::load(paste0(here(),'/G_Analysis_bevioral_data_social/modelfits/points_age_advisor_model.RData'))

## parameters of the model
params <- rownames(fixef(points_age_advisor_model))

## names to assign to the params (for covenience when calling results below)
names <- c("intercept", "medium", "low", "adolescents", "ado_medium", "ado_low" )

## extract coefficients from model object 
coef_points <- summarize_model(points_age_advisor_model, params, names)

## list of hypotheses to test  
hyp_list_points <- c(
  "age_fadolescents >  0",
  "demo_quality_fmedium < 0",
  "demo_quality_fworst	 < 0",
  "demo_quality_fmedium:age_fadolescents < 0",
  "demo_quality_fworst:age_fadolescents <  0"
)

## extract BF for each hypothesis
BFs_points <- test_hypotheses(points_age_advisor_model, hyp_list_points)

```

Across all experimental treatments, adolescents and adults did not differed in points scored (two-sided t-test, t = `r round(t_test_points$statistic,2)`, df = `r round(t_test_points$parameter,2)`, p-value = `r round(t_test_points$p.value,2)`). Regression analysis (Figure 3a) shows that the quality of the advisor signifincaly impacted performance. Both adolescents and adults performing the best in high quality advisor rounds, while performance declined in the remaining treatmentens (medium quality: b = `r coef_points$medium$estimate`, C.I.= [`r coef_points$medium$ci_low`, `r coef_points$medium$ci_high`], BF = `r BFs_points[[2]]`; low quality: b = `r coef_points$low$estimate`, C.I.= [`r coef_points$low$ci_low`, `r coef_points$low$ci_high`], BF = `r BFs_points[[3]]`), indicating that worst social information led to fewer points gained. 
Finally, across all treatments there was no interaction effect between age group and advisor quality high_quality ado: [β = `r coef_points$adolescents$estimate`, C.I. = [`r coef_points$adolescents$ci_low`, `r coef_points$adolescents$ci_high`], BF = `r BFs_points[[1]]`], (age groupmedium quality: b = `r coef_points$ado_medium$estimate`, C.I. = [`r coef_points$ado_medium$ci_low`, `r coef_points$ado_medium$ci_high`], BF = `r BFs_points[[4]]`; age grouplow: b = `r coef_points$ado_low$estimate`, C.I. = [`r coef_points$ado_low$ci_low`, `r coef_points$ado_low$ci_high`], BF = `r BFs_points[[5]]`), suggesting that potential differences in social information use across treatments did not lead to differences in performance.

## social learning

```{r differences in copy}
## mean copy by group t_test
t_test_copy <- 
  all_data %>%
  group_by(uniqueID, round, gem_found, age_f, demo_quality_f) %>%
  filter(social_info_use == "copy") %>%
  count(social_info_use) %>% 
  ungroup() %>% 
  filter(n != 0) %>% 
  group_by(uniqueID) %>% 
  mutate(mean_copy = mean(n), na.rm = TRUE) %>% 
  select(age_f, uniqueID, mean_copy) %>% 
  distinct() %>% 
  t.test(mean_copy ~ age_f, data = ., alternative = "two.sided", paired = FALSE)

copy_summary <- all_data %>% 
 group_by(uniqueID, round, gem_found, age_f, demo_quality_f, treatment) %>%
  filter(social_info_use == "copy") %>%
  count(social_info_use) %>% 
  ungroup() %>% 
  filter(n!=0) %>% 
  select(treatment, n ) %>% 
  group_by(treatment) %>% 
  summarise(mean_copy = mean(n),
             sd = sd(n))


## load model fit file
load(file = paste0(here(),'/G_Analysis_bevioral_data_social/modelfits/poission_regression_all_rounds_slopes.RData'))

## parameters of the model
params_copy <- rownames(fixef(model_random_slopes))

## names to assign to the params (for convenience when calling results below)
names_copy <- c("intercept", "medium", "low", "adolescents", "ado_medium", "ado_low" )

## extract coefficients from model object 
coef_copy <- summarize_model(model_random_slopes, params_copy, names_copy, digits = 2)

## list of hypotheses to test  
hyp_list_copy <- c(
  "age_fadolescents >  0",
  "demo_quality_fmedium < 0",
  "demo_quality_fworst	 < 0",
  "demo_quality_fmedium:age_fadolescents < 0",
  "demo_quality_fworst:age_fadolescents =  0"
)

## extract BF for each hypothesis
BFs_copy <- test_hypotheses(model_random_slopes, hyp_list_copy)

```

To test if these differences were indeed driven by adolescents’ using high quality social information more effectively, we looked at how often participants copied advisors. Despite large individual variability in copying behaviour, across all experimental treatments, adolescents used on average more social information than adults (two-sided t-test: t = `r round(t_test_copy$statistic,2)`, df = `r round(t_test_copy$parameter,2)`, p = `r round(t_test_copy$p.value,2)`, figure 2b). Adolescents copied significantly more than adults in the rounds where the advisors were of high quality (adolescents mean = `copy_summary$mean_copy[copy_summary$treatment == "ado_best"]` , s.d. = 6.83; adults mean = `r  copy_summary$mean_copy[copy_summary$treatment == "adu_best"]`, s.d. = 6.81; IR = `r coef_copy$adolescents$estimate`; CI = [`r coef_copy$adolescents$ci_low`, `r coef_copy$adolescents$ci_high`], BF = `r``BFs_copy[[1]]`). In the rest of the experimental treatments there was no difference between adolescents and adults (medium quality*age_group: IR = `r coef_copy$medium$estimate`; CI = [`r coef_copy$medium$ci_low`, `r coef_copy$medium$ci_high`], BF = `r`* `BFs_copy[[2]]`*; low quality*age_group: IR = `r coef_copy$low$estimate`; CI = [`r coef_copy$low$ci_low`, `r coef_copy$low$ci_high`], BF = `r``BFs_copy[[3]]`), with both groups copying the medium quality advisor (adolescents mean = 6.32, s.d. = 5.37; adults mean = 5.88, s.d. = 5.17; IR = `r coef_copy$ado_medium$estimate`; CI = [`r coef_copy$ado_medium$ci_low`, `r coef_copy$ado_medium$ci_high`], BF = `r``BFs_copy[[4]]`), and the least when quality of social information was low (adolescents mean = 4.29, s.d. = 4.31; adults mean = 3.78, s.d. = 3.24; IR = `r coef_copy$ado_low$estimate`; CI = [`r coef_copy$ado_low$ci_low`, `r coef_copy$ado_low$ci_high`], BF = `r BFs_copy[[5]]`). Overall, these results indicate some adaptive social information use in both groups, and especially adolescents, who copied the most in treatments where advisor quality was the highest.

## finding gems



```{r}
## select only one observation per participant
t_test_gem <- all_data %>%  
  filter(gem_found == 1) %>% 
  select(round_gem_found, age_f, demo_quality_f, uniqueID) %>% 
  distinct() %>% 
  ungroup() %>% 
  select(age_f, round_gem_found, demo_quality_f, uniqueID ) %>% 
  group_by(uniqueID) %>% 
  mutate( mean_round_gem_found = mean(round_gem_found),
             sd = sd (round_gem_found)) %>% 
  select(mean_round_gem_found, age_f,uniqueID) %>% 
  distinct() %>% 
  ungroup() %>% 
  stats::t.test(mean_round_gem_found ~ age_f, data = ., alternative = "two.sided", paired = FALSE)

## load model fit
base::load(paste0(here(),'/G_Analysis_bevioral_data_social/modelfits/gem_found_when_model.RData'))

## parameters of the model
params_gems <- rownames(fixef(gem_found_when_model))

## names to assign to the params (for covenience when calling results below)
names_gems <- c("intercept", "medium", "low", "adolescents", "ado_medium", "ado_low" )

## extract coefficients from model object 
coef_gems <- summarize_model(gem_found_when_model, params_gems, names_gems, digits = 2)

## list of hypotheses to test  
hyp_list_gems <- c(
  "age_fadolescents <  0",
  "demo_quality_fmedium < 0",
  "demo_quality_fworst	< 0",
  "demo_quality_fmedium:age_fadolescents < 0",
  "demo_quality_fworst:age_fadolescents <  0"
)

## extract BF for each hypothesis
BFs_copy <- test_hypotheses(gem_found_when_model, hyp_list_copy)
```
```{r}

##Finally, we looked at how often participants found gems and how many attempts it took them. Across all rounds adolescents found gems earlier than adults (adolescents mean clicks = 11.9, s.d. = 6.73; adults mean clicks = 13.1, s.d. = 7.66; two-sided t-test, t = `r round(t_test_gem$statistic,2)`, df = `r round(t_test_gem$parameter,2)`, p-value = `r round(t_test_gem$p.value,2)`). In the high quality advisor rounds (i.e. where the advisor found the gem), adolescents were faster than adults (adolescents mean = 12.8 clicks, s.d. = 5.92; adults mean = 14.1, s.d. = 6.86; poisson regression, high quality advisor: IR = `r coef_gems$adolescents$estimate`; CI = [`r coef_gems$adolescents$ci_low`, `r coef_gems$adolescents$ci_high`], BF = `r BF_high_quality`). In the remaining rounds (medium and low quality advisor), participants had to find the gems through individual exploration, resulting in a substantial drop in proportion of gems found (24%) compared to the high quality advisor rounds (65%). However, when they did find the gems in the medium quality advisor treatment, both adolescents and adults were faster than in the high quality advisor rounds (adolescents mean = 10.4, adults mean = 11.0; IR = `r coef_gems$medium$estimate`; CI = [`r coef_gems$medium$ci_low`, `r coef_gems$medium$ci_high`], BF = `r BF_medium_quality`), but there was no difference across groups (advisor quality:medium\*age_group: IR = `r coef_gems$ado_medium$estimate`; CI = [`r coef_gems$ado_medium$ci_low`, `r coef_gems$ado_medium$ci_high`], BF = `r BF_ado_medium`). Finally, when participants found gems in the low quality treatment, adolescents were faster than adults (adolescents mean = 10.8, adults mean = 12.1; IR = `r coef_gems$low$estimate`; CI = [`r coef_gems$low$ci_low`, `r coef_gems$low$ci_high`], BF = `r BF_low_quality`), but not faster than either group in the high quality advisor rounds (IR = `r coef_gems$ado_low$estimate`; CI = [`r coef_gems$ado_low$ci_low`,  ]


```

 